<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Create Account - LoanAdvisor</title>

    <!-- Security Headers (should be enforced server-side) -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'">
    <meta name="referrer" content="no-referrer">

    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Banking Color Palette - Professional & Trustworthy */
            --primary-blue: #1e40af;
            --primary-dark: #1e3a8a;
            --secondary-gray: #64748b;
            --success-green: #10b981;
            --error-red: #ef4444;
            --warning-amber: #f59e0b;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --border-gray: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;

            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;

            /* Border Radius */
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            height: 100%;
            width: 100vw;
            margin: 0;
            padding: 0;
            /* Background handled by WebGL script */
            background: transparent;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* body::before removed to allow WebGL background */
        /*
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            background: 
                radial-gradient(circle at 20% 30%, rgba(30, 64, 175, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(30, 58, 138, 0.08) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
            animation: floatShapes 20s ease-in-out infinite;
        }
        */

        @keyframes floatShapes {

            0%,
            100% {
                opacity: 0.6;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.1);
            }
        }

        /* Full Width Layout Wrapper */
        .auth-layout {
            min-height: 100vh;
            width: 100%;
            display: flex;
            align-items: center;
            /* vertical center */
            justify-content: center;
            /* horizontal center */
            padding: 2rem;
            background: transparent;
        }

        /* Signup Container */
        .signup-container {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 1.25rem;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 8px 32px rgba(30, 64, 175, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            max-width: 600px;
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .signup-container:hover {
            box-shadow:
                0 25px 70px rgba(0, 0, 0, 0.6),
                0 10px 32px rgba(30, 64, 175, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Back to Home Link */
        .back-to-home {
            position: fixed;
            top: var(--spacing-lg);
            left: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            color: white;
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            padding: 0.5rem var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .back-to-home:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(-2px);
        }

        .back-to-home::before {
            content: '‚Üê';
            font-size: 1.125rem;
        }

        /* Header */
        .signup-header {
            background: rgba(30, 64, 175, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            padding: 2.5rem 2rem 1.5rem 2rem;
            text-align: center;
            position: relative;
            border-top-left-radius: 1.25rem;
            border-top-right-radius: 1.25rem;
            box-shadow: 0 4px 16px rgba(30, 64, 175, 0.3);
        }

        .signup-header .logo {
            width: 56px;
            height: 56px;
            margin: 0 auto 1rem;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), inset 0 1px 2px rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .signup-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .signup-header p {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        /* Form */
        .signup-form {
            padding: 2rem 2rem 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Alert Messages */
        .alert {
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-lg);
            font-size: 0.875rem;
            display: none;
        }

        .alert.show {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .alert-icon {
            font-size: 1.125rem;
            flex-shrink: 0;
        }

        /* Form Groups */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: var(--spacing-sm);
        }

        .form-label .required {
            color: var(--error-red);
            margin-left: var(--spacing-xs);
        }

        .form-label .optional {
            color: var(--text-muted);
            font-weight: normal;
            font-size: 0.75rem;
            margin-left: var(--spacing-xs);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem var(--spacing-md);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            font-size: 0.9375rem;
            color: #ffffff;
            font-weight: 500;
            transition: all 0.2s ease;
            background: rgba(30, 41, 59, 0.5);
            /* darker glassmorphic for select */
            backdrop-filter: blur(10px);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Make select dropdown options visible on dark background */
        select.form-control,
        select.form-control option {
            background: rgba(30, 41, 59, 0.95);
            color: #fff;
        }


        .form-control:focus {
            outline: none;
            border-color: rgba(147, 197, 253, 0.8);
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-control.error {
            border-color: var(--error-red);
        }

        .form-control.success {
            border-color: var(--success-green);
        }

        /* Input Group (for icons/buttons inside input) */
        .input-group {
            position: relative;
        }

        .input-group .form-control {
            padding-right: 3rem;
        }

        .input-icon {
            position: absolute;
            right: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            cursor: pointer;
            user-select: none;
            transition: color 0.2s ease;
        }

        .input-icon:hover {
            color: var(--text-secondary);
        }

        /* Form Text (Helper/Error) */
        .form-text {
            font-size: 0.8125rem;
            margin-top: var(--spacing-sm);
            display: none;
        }

        .form-text.show {
            display: block;
        }

        .form-text.error {
            color: var(--error-red);
        }

        .form-text.success {
            color: var(--success-green);
        }

        .form-text.info {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        /* Password Strength Indicator */
        .password-strength {
            margin-top: var(--spacing-sm);
            display: none;
        }

        .password-strength.show {
            display: block;
        }

        .password-strength-bar-container {
            height: 4px;
            background: var(--border-gray);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin-bottom: var(--spacing-xs);
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            transition: width 0.3s ease, background-color 0.3s ease;
            border-radius: var(--radius-sm);
        }

        .password-strength-bar.weak {
            width: 33%;
            background: var(--error-red);
        }

        .password-strength-bar.medium {
            width: 66%;
            background: var(--warning-amber);
        }

        .password-strength-bar.strong {
            width: 100%;
            background: var(--success-green);
        }

        .password-strength-text {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Two Column Layout for PIN fields */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        @media (max-width: 480px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Checkbox Group */
        .checkbox-group {
            margin-bottom: var(--spacing-md);
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .checkbox-item input[type="checkbox"] {
            margin-top: 0.25rem;
            width: 1rem;
            height: 1rem;
            cursor: pointer;
            accent-color: var(--primary-blue);
        }

        .checkbox-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .checkbox-label a {
            color: var(--primary-blue);
            text-decoration: none;
        }

        .checkbox-label a:hover {
            text-decoration: underline;
        }

        /* Passkey Section */
        .passkey-section {
            background: var(--bg-light);
            border: 1px solid var(--border-gray);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .passkey-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .passkey-icon {
            font-size: 1.5rem;
        }

        .passkey-header h3 {
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .passkey-description {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
        }

        .passkey-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .btn-passkey {
            flex: 1;
            min-width: 150px;
            padding: 0.625rem var(--spacing-md);
            border: 1px solid var(--border-gray);
            border-radius: var(--radius-md);
            background: var(--bg-white);
            color: var(--text-primary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-passkey:hover {
            background: var(--bg-light);
            border-color: var(--primary-blue);
        }

        .btn-passkey.primary {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .btn-passkey.primary:hover {
            background: var(--primary-dark);
        }

        /* CAPTCHA Container */
        .captcha-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .captcha-display {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.75rem;
            font-weight: bold;
            letter-spacing: 0.5rem;
            color: #ffffff;
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .captcha-display::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: repeating-linear-gradient(90deg,
                    var(--border-gray) 0px,
                    var(--border-gray) 5px,
                    transparent 5px,
                    transparent 10px);
            transform: translateY(-50%) rotate(-3deg);
        }

        .captcha-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .captcha-input {
            flex: 1;
        }

        .btn-refresh {
            padding: 0.75rem var(--spacing-md);
            background: var(--bg-white);
            border: 1px solid var(--border-gray);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.125rem;
        }

        .btn-refresh:hover {
            background: var(--bg-light);
            border-color: var(--secondary-gray);
        }

        /* Primary Button */
        .btn-primary {
            width: 100%;
            padding: 0.875rem var(--spacing-md);
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: var(--spacing-md);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:disabled {
            background: var(--secondary-gray);
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Footer */
        .signup-footer {
            padding: 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            text-align: center;
        }

        .footer-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .footer-text a {
            color: var(--primary-blue);
            text-decoration: none;
        }

        .footer-text a:hover {
            text-decoration: underline;
        }

        /* Security Badge */
        .security-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-md);
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .security-icon {
            color: var(--success-green);
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            margin-right: var(--spacing-sm);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 968px) {
            .auth-layout {
                justify-content: center;
                padding-left: 2rem;
            }
        }

        @media (max-width: 480px) {
            .auth-layout {
                padding: 1rem;
            }

            .signup-container {
                border-radius: 0.75rem;
                max-width: 100%;
            }

            .signup-header {
                padding: 1.25rem 1rem 1rem 1rem;
            }

            .signup-form {
                padding: 1.25rem 1rem 1rem 1rem;
            }

            .captcha-display {
                font-size: 1.5rem;
                letter-spacing: 0.3rem;
            }

            .back-to-home {
                position: absolute;
                top: 0.75rem;
                left: 0.75rem;
            }
        }

        /* Accessibility */
        *:focus-visible {
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        /* ============================================
           MULTI-STEP FORM STYLES
           ============================================ */

        /* Step Indicator */
        .step-indicator {
            padding: 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        .step-info {
            text-align: center;
            margin-bottom: 1rem;
        }

        .step-number {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .step-title {
            font-size: 1.125rem;
            color: #ffffff;
            font-weight: 700;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        /* Step Container */
        .step-container {
            display: none;
        }

        .step-container.active {
            display: block;
        }

        /* Navigation Buttons */
        .step-navigation {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-back {
            flex: 1;
            padding: 0.875rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-back:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .btn-continue {
            flex: 2;
            padding: 0.875rem 1rem;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-continue:hover:not(:disabled) {
            background: var(--primary-dark);
            box-shadow: var(--shadow-md);
        }

        .btn-continue:disabled,
        .btn-back:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Radio Buttons */
        .radio-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .radio-item {
            flex: 1;
            min-width: 120px;
        }

        .radio-item input[type="radio"] {
            display: none;
        }

        .radio-label {
            display: block;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            color: #ffffff;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radio-item input[type="radio"]:checked+.radio-label {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }

        .radio-label:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Success Screen */
        .success-screen {
            text-align: center;
            padding: 2rem 1rem;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .success-screen h2 {
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .success-screen p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1.5rem;
        }

        .customer-id-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .customer-id-label {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
        }

        .customer-id-value {
            font-size: 1.5rem;
            color: #ffffff;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .kyc-status {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.5);
            border-radius: var(--radius-md);
            color: #fbbf24;
            font-weight: 600;
            font-size: 0.875rem;
        }

        /* Signature Canvas */
        .signature-pad {
            width: 100%;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            cursor: crosshair;
        }

        .signature-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn-clear-signature {
            padding: 0.5rem 1rem;
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.5);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-clear-signature:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Consent Box */
        .consent-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .consent-box::-webkit-scrollbar {
            width: 6px;
        }

        .consent-box::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .consent-box::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <a href="/" class="back-to-home">Back to Home</a>
    <div class="auth-layout">
        <div class="signup-container">
            <!-- Header -->
            <div class="signup-header">
                <div class="logo">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                        <path d="M12 12c2.76 0 5-2.24 5-5S14.76 2 12 2 7 4.24 7 7s2.24 5 5 5z" fill="white" />
                        <path d="M4 20c0-4 4-6 8-6s8 2 8 6" fill="white" />
                    </svg>
                </div>
                <h1>Create Your Account</h1>
                <p>Start your secure loan application journey</p>
            </div>

            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step-info">
                    <div class="step-number" id="stepNumber">Step 1 of 6</div>
                    <div class="step-title" id="stepTitle">Account Creation</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 16.67%"></div>
                </div>
            </div>

            <!-- STEP 1: Account Creation -->
            <div class="step-container active" id="step1">
                <!-- Signup Form -->
                <form class="signup-form" id="signupForm" novalidate>
                    <!-- Alert Message -->
                    <div class="alert" id="alertMessage" role="alert">
                        <span class="alert-icon" id="alertIcon"></span>
                        <span id="alertText"></span>
                    </div>

                    <!-- Mobile Number -->
                    <div class="form-group">
                        <label for="mobileNumber" class="form-label">
                            Mobile Number<span class="required">*</span>
                        </label>
                        <input type="text" id="mobileNumber" class="form-control"
                            placeholder="Enter 10-digit mobile number" autocomplete="tel" inputmode="numeric"
                            maxlength="10" required aria-describedby="mobileError mobileInfo">
                        <div class="form-text info show" id="mobileInfo">Used for account verification and alerts</div>
                        <div class="form-text error" id="mobileError"></div>
                    </div>

                    <!-- Email Address -->
                    <div class="form-group">
                        <label for="email" class="form-label">
                            Email Address<span class="required">*</span>
                        </label>
                        <input type="email" id="email" class="form-control" placeholder="your.email@example.com"
                            autocomplete="email" required aria-describedby="emailError">
                        <div class="form-text error" id="emailError"></div>
                    </div>

                    <!-- Create Password -->
                    <div class="form-group">
                        <label for="password" class="form-label">
                            Create Password<span class="required">*</span>
                        </label>
                        <div class="input-group">
                            <input type="password" id="password" class="form-control"
                                placeholder="Create a strong password" autocomplete="new-password" required
                                aria-describedby="passwordError passwordStrength">
                            <span class="input-icon" id="togglePassword" tabindex="0" role="button"
                                aria-label="Toggle password visibility">
                                üëÅÔ∏è
                            </span>
                        </div>
                        <div class="password-strength" id="passwordStrength" aria-live="polite">
                            <div class="password-strength-bar-container">
                                <div class="password-strength-bar" id="passwordStrengthBar"></div>
                            </div>
                            <div class="password-strength-text" id="passwordStrengthText"></div>
                        </div>
                        <div class="form-text error" id="passwordError"></div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">
                            Confirm Password<span class="required">*</span>
                        </label>
                        <div class="input-group">
                            <input type="password" id="confirmPassword" class="form-control"
                                placeholder="Re-enter your password" autocomplete="new-password" required
                                aria-describedby="confirmPasswordError">
                            <span class="input-icon" id="toggleConfirmPassword" tabindex="0" role="button"
                                aria-label="Toggle password visibility">
                                üëÅÔ∏è
                            </span>
                        </div>
                        <div class="form-text error" id="confirmPasswordError"></div>
                    </div>

                    <!-- PIN Fields Row -->
                    <div class="form-row">
                        <!-- Create 6-Digit PIN -->
                        <div class="form-group">
                            <label for="pin" class="form-label">
                                Create 6-Digit PIN<span class="required">*</span>
                            </label>
                            <input type="password" id="pin" class="form-control" placeholder="6-digit PIN"
                                autocomplete="off" inputmode="numeric" maxlength="6" required
                                aria-describedby="pinError">
                            <div class="form-text error" id="pinError"></div>
                        </div>

                        <!-- Confirm PIN -->
                        <div class="form-group">
                            <label for="confirmPin" class="form-label">
                                Confirm PIN<span class="required">*</span>
                            </label>
                            <input type="password" id="confirmPin" class="form-control" placeholder="Re-enter PIN"
                                autocomplete="off" inputmode="numeric" maxlength="6" required
                                aria-describedby="confirmPinError">
                            <div class="form-text error" id="confirmPinError"></div>
                        </div>
                    </div>

                    <!-- Security Hint (Optional) -->
                    <div class="form-group">
                        <label for="securityHint" class="form-label">
                            Security Hint<span class="optional">(Optional)</span>
                        </label>
                        <input type="text" id="securityHint" class="form-control"
                            placeholder="e.g., Your favorite color or pet name" maxlength="50"
                            aria-describedby="securityHintInfo">
                        <div class="form-text info show">Reminder only, not used for authentication</div>
                        <div class="form-text error" id="securityHintError"></div>
                    </div>

                    <!-- Consent Checkboxes -->
                    <div class="form-group">
                        <label class="form-label">Mandatory Consents<span class="required">*</span></label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="termsConsent" required>
                                <label for="termsConsent" class="checkbox-label">
                                    I agree to the <a href="#terms" target="_blank">Terms & Conditions</a>
                                </label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="privacyConsent" required>
                                <label for="privacyConsent" class="checkbox-label">
                                    I agree to the <a href="#privacy" target="_blank">Privacy Policy</a>
                                </label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dataConsent" required>
                                <label for="dataConsent" class="checkbox-label">
                                    I consent to data processing as per <a href="#dpdp" target="_blank">DPDP Act</a>
                                </label>
                            </div>
                        </div>
                        <div class="form-text error" id="consentError"></div>
                    </div>

                    <!-- Optional Checkboxes -->
                    <div class="form-group">
                        <label class="form-label">Optional Preferences</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="rememberDevice">
                                <label for="rememberDevice" class="checkbox-label">
                                    Remember this device for 30 days
                                </label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enablePasskey">
                                <label for="enablePasskey" class="checkbox-label">
                                    Enable passkey login on this device
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Passkey Setup (Optional) -->
                    <div class="passkey-section">
                        <div class="passkey-header">
                            <span class="passkey-icon">üîê</span>
                            <h3>Passkey Login (Recommended)</h3>
                        </div>
                        <p class="passkey-description">
                            Passkeys are a secure, password-free way to sign in using your device's biometrics or screen
                            lock.
                            You can set this up now or skip and add it later from settings.
                        </p>
                        <div class="passkey-actions">
                            <button type="button" class="btn-passkey primary" id="setupPasskey">
                                Set up passkey now
                            </button>
                            <button type="button" class="btn-passkey" id="skipPasskey">
                                Skip for now
                            </button>
                        </div>
                    </div>

                    <!-- CAPTCHA -->
                    <div class="form-group">
                        <label for="captcha" class="form-label">
                            Verification Code<span class="required">*</span>
                        </label>
                        <div class="captcha-container">
                            <div class="captcha-display" id="captchaDisplay" aria-label="Captcha image">
                                <span id="captchaCode">LOADING</span>
                            </div>
                            <div class="captcha-actions">
                                <input type="text" id="captcha" class="form-control captcha-input"
                                    placeholder="Enter code above" autocomplete="off" maxlength="6" required
                                    aria-describedby="captchaError">
                                <button type="button" class="btn-refresh" id="refreshCaptcha"
                                    aria-label="Refresh captcha">
                                    üîÑ
                                </button>
                            </div>
                            <div class="form-text error" id="captchaError"></div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="button" class="btn-primary" id="step1Continue">
                        Continue to Next Step
                    </button>

                    <!-- Security Badge -->
                    <div class="security-badge">
                        <span class="security-icon">üîí</span>
                        <span>Your data is encrypted and secured with banking-grade protection</span>
                    </div>
                </form>
            </div>

            <!-- STEP 2: Personal Details -->
            <div class="step-container" id="step2">
                <form class="signup-form" id="step2Form">
                    <!-- Title -->
                    <div class="form-group">
                        <label class="form-label">Title<span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="titleMr" name="title" value="Mr" required>
                                <label for="titleMr" class="radio-label">Mr</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="titleMs" name="title" value="Ms">
                                <label for="titleMs" class="radio-label">Ms</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="titleMrs" name="title" value="Mrs">
                                <label for="titleMrs" class="radio-label">Mrs</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="titleOther" name="title" value="Other">
                                <label for="titleOther" class="radio-label">Other</label>
                            </div>
                        </div>
                    </div>

                    <!-- First Name -->
                    <div class="form-group">
                        <label for="firstName" class="form-label">First Name<span class="required">*</span></label>
                        <input type="text" id="firstName" class="form-control" placeholder="Enter first name" required>
                    </div>

                    <!-- Middle Name -->
                    <div class="form-group">
                        <label for="middleName" class="form-label">Middle Name<span
                                class="optional">(Optional)</span></label>
                        <input type="text" id="middleName" class="form-control" placeholder="Enter middle name">
                    </div>

                    <!-- Last Name -->
                    <div class="form-group">
                        <label for="lastName" class="form-label">Last Name<span class="required">*</span></label>
                        <input type="text" id="lastName" class="form-control" placeholder="Enter last name" required>
                    </div>

                    <!-- Date of Birth -->
                    <div class="form-group">
                        <label for="dob" class="form-label">Date of Birth<span class="required">*</span></label>
                        <input type="date" id="dob" class="form-control" required>
                        <div class="form-text info show">You must be at least 18 years old</div>
                    </div>

                    <!-- Gender -->
                    <div class="form-group">
                        <label class="form-label">Gender<span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="genderMale" name="gender" value="Male" required>
                                <label for="genderMale" class="radio-label">Male</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="genderFemale" name="gender" value="Female">
                                <label for="genderFemale" class="radio-label">Female</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="genderOther" name="gender" value="Other">
                                <label for="genderOther" class="radio-label">Other</label>
                            </div>
                        </div>
                    </div>

                    <!-- Nationality -->
                    <div class="form-group">
                        <label for="nationality" class="form-label">Nationality<span class="required">*</span></label>
                        <input type="text" id="nationality" class="form-control" value="Indian" disabled>
                        <div class="form-text info show">Currently available only for Indian nationals</div>
                    </div>

                    <!-- Navigation -->
                    <div class="step-navigation">
                        <button type="button" class="btn-back" id="step2Back">Back</button>
                        <button type="button" class="btn-continue" id="step2Continue">Continue</button>
                    </div>
                </form>
            </div>

            <!-- STEP 3: Address Details -->
            <div class="step-container" id="step3">
                <form class="signup-form" id="step3Form">
                    <!-- Address Line 1 -->
                    <div class="form-group">
                        <label for="address1" class="form-label">Address Line 1<span class="required">*</span></label>
                        <input type="text" id="address1" class="form-control"
                            placeholder="Flat/House No., Building Name" required>
                    </div>

                    <!-- Address Line 2 -->
                    <div class="form-group">
                        <label for="address2" class="form-label">Address Line 2<span class="required">*</span></label>
                        <input type="text" id="address2" class="form-control" placeholder="Street, Area, Locality"
                            required>
                    </div>

                    <!-- City -->
                    <div class="form-group">
                        <label for="city" class="form-label">City<span class="required">*</span></label>
                        <input type="text" id="city" class="form-control" placeholder="Enter city" required>
                    </div>

                    <!-- State -->
                    <div class="form-group">
                        <label for="state" class="form-label">State<span class="required">*</span></label>
                        <select id="state" class="form-control" required>
                            <option value="">Select State</option>
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Chhattisgarh">Chhattisgarh</option>
                            <option value="Goa">Goa</option>
                            <option value="Gujarat">Gujarat</option>
                            <option value="Haryana">Haryana</option>
                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                            <option value="Jharkhand">Jharkhand</option>
                            <option value="Karnataka">Karnataka</option>
                            <option value="Kerala">Kerala</option>
                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Manipur">Manipur</option>
                            <option value="Meghalaya">Meghalaya</option>
                            <option value="Mizoram">Mizoram</option>
                            <option value="Nagaland">Nagaland</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Sikkim">Sikkim</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Telangana">Telangana</option>
                            <option value="Tripura">Tripura</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Uttarakhand">Uttarakhand</option>
                            <option value="West Bengal">West Bengal</option>
                        </select>
                    </div>

                    <!-- PIN Code -->
                    <div class="form-group">
                        <label for="pincode" class="form-label">PIN Code<span class="required">*</span></label>
                        <input type="text" id="pincode" class="form-control" placeholder="Enter 6-digit PIN"
                            maxlength="6" required>
                    </div>

                    <!-- Permanent Address Same -->
                    <div class="form-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="sameAddress">
                            <label for="sameAddress" class="checkbox-label">
                                Permanent address same as current address
                            </label>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="step-navigation">
                        <button type="button" class="btn-back" id="step3Back">Back</button>
                        <button type="button" class="btn-continue" id="step3Continue">Continue</button>
                    </div>
                </form>
            </div>

            <!-- STEP 4: KYC Details -->
            <div class="step-container" id="step4">
                <form class="signup-form" id="step4Form">
                    <!-- PAN Number -->
                    <div class="form-group">
                        <label for="panNumber" class="form-label">PAN Number<span class="required">*</span></label>
                        <input type="text" id="panNumber" class="form-control"
                            placeholder="Enter PAN (e.g., ABCDE1234F)" maxlength="10" style="text-transform: uppercase;"
                            required>
                        <div class="form-text info show">Format: AAAAA1234A (5 letters, 4 digits, 1 letter)</div>
                    </div>

                    <!-- Aadhaar Number -->
                    <div class="form-group">
                        <label for="aadhaarNumber" class="form-label">Aadhaar Number<span
                                class="required">*</span></label>
                        <input type="text" id="aadhaarNumber" class="form-control" placeholder="XXXX-XXXX-1234"
                            maxlength="14" required>
                        <div class="form-text info show">Last 4 digits only for verification purposes</div>
                    </div>

                    <!-- Aadhaar Consent -->
                    <div class="form-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="aadhaarConsent" required>
                            <label for="aadhaarConsent" class="checkbox-label">
                                I consent to use my Aadhaar for KYC verification. My Aadhaar will not be stored or used
                                for any other purpose.
                            </label>
                        </div>
                    </div>

                    <div class="alert alert-info show" style="display: flex;">
                        <span class="alert-icon">‚ÑπÔ∏è</span>
                        <span>Your KYC details will be verified as per RBI guidelines. This is a one-time
                            process.</span>
                    </div>

                    <!-- Navigation -->
                    <div class="step-navigation">
                        <button type="button" class="btn-back" id="step4Back">Back</button>
                        <button type="button" class="btn-continue" id="step4Continue">Continue</button>
                        <button type="button" class="btn-continue" id="step4Skip"
                            style="background:rgba(251,191,36,0.2);color:#fbbf24;border:1px solid #fbbf24;">Skip for
                            now</button>
                    </div>
                </form>
            </div>

            <!-- STEP 5: Digital Consent & Signature -->
            <div class="step-container" id="step5">
                <form class="signup-form" id="step5Form">
                    <!-- Consent Text -->
                    <div class="form-group">
                        <label class="form-label">Terms & Conditions<span class="required">*</span></label>
                        <div class="consent-box">
                            <h4 style="color: #ffffff; margin-bottom: 0.5rem;">Loan Application Agreement</h4>
                            <p>By proceeding, you acknowledge and agree to the following:</p>
                            <ul style="padding-left: 1.5rem;">
                                <li>All information provided is accurate and complete</li>
                                <li>You authorize us to verify your details with credit bureaus</li>
                                <li>You understand loan approval is subject to credit assessment</li>
                                <li>Interest rates are as per RBI guidelines and market conditions</li>
                                <li>Processing fees are non-refundable</li>
                                <li>You consent to receive communications via SMS/Email/Phone</li>
                                <li>Your data will be processed as per DPDP Act 2023</li>
                                <li>You have read and understood our Privacy Policy</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Mandatory Consent -->
                    <div class="form-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="finalConsent" required>
                            <label for="finalConsent" class="checkbox-label">
                                I have read and accept all terms and conditions
                            </label>
                        </div>
                    </div>

                    <!-- Digital Signature -->
                    <div class="form-group">
                        <label class="form-label">Digital Signature<span class="required">*</span></label>
                        <canvas id="signatureCanvas" class="signature-pad" width="500" height="200"></canvas>
                        <div class="signature-controls">
                            <button type="button" class="btn-clear-signature" id="clearSignature">Clear
                                Signature</button>
                        </div>
                        <div class="form-text info show">Draw your signature above using mouse or touch</div>
                    </div>

                    <!-- Navigation -->
                    <div class="step-navigation">
                        <button type="button" class="btn-back" id="step5Back">Back</button>
                        <button type="button" class="btn-continue" id="step5Continue">Submit Application</button>
                    </div>
                </form>
            </div>

            <!-- STEP 6: Confirmation -->
            <div class="step-container" id="step6">
                <div class="signup-form">
                    <div class="success-screen">
                        <div class="success-icon">‚úÖ</div>
                        <h2>Registration Complete!</h2>
                        <p>Your account has been successfully created</p>

                        <div class="customer-id-box">
                            <div class="customer-id-label">Your Customer ID</div>
                            <div class="customer-id-value" id="generatedCustomerId">LA2025XXXX</div>
                        </div>

                        <div style="margin: 1.5rem 0;">
                            <div class="customer-id-label">KYC Status</div>
                            <div class="kyc-status">‚è≥ Pending Verification</div>
                        </div>

                        <p style="font-size: 0.875rem; margin-bottom: 2rem;">
                            Your KYC verification is in progress. You will receive an update within 24-48 hours via SMS
                            and email.
                        </p>

                        <button type="button" class="btn-primary" id="goToDashboard">
                            Go to Dashboard
                        </button>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="signup-footer">
                <p class="footer-text">
                    Already have an account? <a href="/login.html">Login here</a>
                </p>
                <p class="footer-text">
                    Protected by RBI-compliant security protocols
                </p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // SMOKEY BACKGROUND WEBGL SHADER
        // ============================================
        (function () {
            // Create Canvas
            const canvas = document.createElement('canvas');
            canvas.id = 'smokey-background';
            canvas.style.position = 'fixed';
            canvas.style.top = '0';
            canvas.style.left = '0';
            canvas.style.width = '100vw';
            canvas.style.height = '100vh';
            canvas.style.zIndex = '-1';
            canvas.style.pointerEvents = 'none';
            document.body.prepend(canvas);

            // WebGL Context
            const gl = canvas.getContext("webgl");
            if (!gl) {
                console.error("WebGL not supported");
                return;
            }

            // Shaders
            const vertexSource = `
                attribute vec4 a_position;
                void main() {
                    gl_Position = a_position;
                }
            `;

            const fragmentSource = `
                precision mediump float;

                uniform vec2 iResolution;
                uniform float iTime;
                uniform vec2 iMouse;
                uniform vec3 u_color;

                void mainImage(out vec4 fragColor, in vec2 fragCoord){
                    vec2 uv = fragCoord / iResolution;
                    vec2 centeredUV = (2.0 * fragCoord - iResolution.xy) / min(iResolution.x, iResolution.y);

                    float time = iTime * 0.5;

                    vec2 mouse = iMouse / iResolution;
                    vec2 rippleCenter = 2.0 * mouse - 1.0;

                    vec2 distortion = centeredUV;
                    for (float i = 1.0; i < 8.0; i++) {
                        distortion.x += 0.5 / i * cos(i * 2.0 * distortion.y + time + rippleCenter.x * 3.1415);
                        distortion.y += 0.5 / i * cos(i * 2.0 * distortion.x + time + rippleCenter.y * 3.1415);
                    }

                    float wave = abs(sin(distortion.x + distortion.y + time));
                    float glow = smoothstep(0.9, 0.2, wave);

                    fragColor = vec4(u_color * glow, 1.0);
                }

                void main() {
                    mainImage(gl_FragColor, gl_FragCoord.xy);
                }
            `;

            function compileShader(type, source) {
                const shader = gl.createShader(type);
                gl.shaderSource(shader, source);
                gl.compileShader(shader);
                if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                    console.error("Shader compilation error:", gl.getShaderInfoLog(shader));
                    gl.deleteShader(shader);
                    return null;
                }
                return shader;
            }

            const vertexShader = compileShader(gl.VERTEX_SHADER, vertexSource);
            const fragmentShader = compileShader(gl.FRAGMENT_SHADER, fragmentSource);

            if (!vertexShader || !fragmentShader) return;

            const program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);

            if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                console.error("Program linking error:", gl.getProgramInfoLog(program));
                return;
            }

            gl.useProgram(program);

            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]), gl.STATIC_DRAW);

            const positionLocation = gl.getAttribLocation(program, "a_position");
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

            const iResolutionLocation = gl.getUniformLocation(program, "iResolution");
            const iTimeLocation = gl.getUniformLocation(program, "iTime");
            const iMouseLocation = gl.getUniformLocation(program, "iMouse");
            const uColorLocation = gl.getUniformLocation(program, "u_color");

            let startTime = Date.now();
            let mousePosition = { x: 0, y: 0 };
            let isHovering = false;

            function hexToRgb(hex) {
                const r = parseInt(hex.substring(1, 3), 16) / 255;
                const g = parseInt(hex.substring(3, 5), 16) / 255;
                const b = parseInt(hex.substring(5, 7), 16) / 255;
                return [r, g, b];
            }

            const [r, g, b] = hexToRgb("#1E40AF");
            gl.uniform3f(uColorLocation, r, g, b);

            function render() {
                const width = window.innerWidth;
                const height = window.innerHeight;

                if (canvas.width !== width || canvas.height !== height) {
                    canvas.width = width;
                    canvas.height = height;
                    gl.viewport(0, 0, width, height);
                }

                const currentTime = (Date.now() - startTime) / 1000;

                gl.uniform2f(iResolutionLocation, width, height);
                gl.uniform1f(iTimeLocation, currentTime);

                const targetX = width / 2;
                const targetY = height / 2;
                gl.uniform2f(iMouseLocation, targetX, targetY);

                gl.drawArrays(gl.TRIANGLES, 0, 6);
                requestAnimationFrame(render);
            }

            // Mouse tracking disabled - animation uses center position
            // window.addEventListener('mousemove', (e) => {
            //     mousePosition = { x: e.clientX, y: e.clientY };
            //     isHovering = true;
            // });

            // window.addEventListener('mouseout', () => {
            //     isHovering = false;
            // });

            render();
        })();
    </script>

    <script>
        // ============================================
        // MULTI-STEP FORM NAVIGATION
        // ============================================

        const multiStepForm = {
            currentStep: 1,
            totalSteps: 6,
            formData: {},

            init() {
                // Restore state if available
                const saved = localStorage.getItem('signupFormState');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        this.currentStep = parsed.currentStep || 1;
                        this.formData = parsed.formData || {};
                    } catch (e) {
                        console.error('Error restoring state:', e);
                        localStorage.removeItem('signupFormState');
                    }
                }
                this.setupNavigation();
                this.setupSignature();
                this.updateProgress();
                this.restoreFields();
            },

            setupNavigation() {
                // Step 1 Continue
                document.getElementById('step1Continue').addEventListener('click', () => {
                    console.log('Step 1 Continue Clicked');
                    if (this.validateStep1()) {
                        this.saveStep1Data();
                        this.goToStep(2);
                    }
                });

                // Step 2 Navigation
                document.getElementById('step2Back').addEventListener('click', () => this.goToStep(1));
                document.getElementById('step2Continue').addEventListener('click', () => {
                    if (this.validateStep2()) {
                        this.saveStep2Data();
                        this.goToStep(3);
                    }
                });

                // Step 3 Navigation
                document.getElementById('step3Back').addEventListener('click', () => this.goToStep(2));
                document.getElementById('step3Continue').addEventListener('click', () => {
                    if (this.validateStep3()) {
                        this.saveStep3Data();
                        this.goToStep(4);
                    }
                });

                // Step 4 Navigation
                document.getElementById('step4Back').addEventListener('click', () => this.goToStep(3));
                document.getElementById('step4Continue').addEventListener('click', () => {
                    if (this.validateStep4()) {
                        this.saveStep4Data();
                        this.goToStep(5);
                    }
                });

                // Step 4 Skip KYC
                document.getElementById('step4Skip').addEventListener('click', () => {
                    // Mark KYC as skipped in formData
                    this.formData.step4 = {
                        kycSkipped: true,
                        skipTimestamp: new Date().toISOString()
                    };
                    this.goToStep(5);
                });

                // Step 5 Navigation
                document.getElementById('step5Back').addEventListener('click', () => this.goToStep(4));
                document.getElementById('step5Continue').addEventListener('click', () => {
                    if (this.validateStep5()) {
                        this.saveStep5Data();
                        this.submitApplication();
                    }
                });

                // Final Dashboard Button
                document.getElementById('goToDashboard').addEventListener('click', () => {
                    // window.location.href = '/dashboard';
                    alert('Redirecting to dashboard...');
                });

                // Same address checkbox
                document.getElementById('sameAddress').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        // Copy address from step 1 or leave blank for now
                        alert('Permanent address marked as same as current address');
                    }
                });
            },

            setupSignature() {
                const canvas = document.getElementById('signatureCanvas');
                const ctx = canvas.getContext('2d');
                let isDrawing = false;
                let hasSignature = false;

                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';

                canvas.addEventListener('mousedown', (e) => {
                    isDrawing = true;
                    const rect = canvas.getBoundingClientRect();
                    ctx.beginPath();
                    ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
                    hasSignature = true;
                });

                canvas.addEventListener('mousemove', (e) => {
                    if (!isDrawing) return;
                    const rect = canvas.getBoundingClientRect();
                    ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                    ctx.stroke();
                });

                canvas.addEventListener('mouseup', () => {
                    isDrawing = false;
                });

                canvas.addEventListener('mouseleave', () => {
                    isDrawing = false;
                });

                // Touch events for mobile
                canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    isDrawing = true;
                    const rect = canvas.getBoundingClientRect();
                    const touch = e.touches[0];
                    ctx.beginPath();
                    ctx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
                    hasSignature = true;
                });

                canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (!isDrawing) return;
                    const rect = canvas.getBoundingClientRect();
                    const touch = e.touches[0];
                    ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
                    ctx.stroke();
                });

                canvas.addEventListener('touchend', () => {
                    isDrawing = false;
                });

                document.getElementById('clearSignature').addEventListener('click', () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    hasSignature = false;
                });

                // Store signature validation function
                this.hasSignature = () => hasSignature;
            },

            goToStep(stepNumber) {
                // Hide all steps
                document.querySelectorAll('.step-container').forEach(step => {
                    step.classList.remove('active');
                });

                // Show target step
                document.getElementById(`step${stepNumber}`).classList.add('active');
                this.currentStep = stepNumber;
                this.updateProgress();
                this.saveState();

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            },

            updateProgress() {
                const stepTitles = [
                    'Account Creation',
                    'Personal Details',
                    'Address Information',
                    'KYC Verification',
                    'Consent & Signature',
                    'Registration Complete'
                ];

                document.getElementById('stepNumber').textContent = `Step ${this.currentStep} of ${this.totalSteps}`;
                document.getElementById('stepTitle').textContent = stepTitles[this.currentStep - 1];

                const progress = (this.currentStep / this.totalSteps) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
            },

            // STEP 1 VALIDATION (Keep existing validation)
            validateStep1() {
                const mobile = document.getElementById('mobileNumber').value;
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const pin = document.getElementById('pin').value;
                const confirmPin = document.getElementById('confirmPin').value;
                const termsConsent = document.getElementById('termsConsent').checked;
                const privacyConsent = document.getElementById('privacyConsent').checked;
                const dataConsent = document.getElementById('dataConsent').checked;
                const captcha = document.getElementById('captcha').value.toUpperCase();

                if (!mobile || mobile.length !== 10) {
                    alert('Please enter a valid 10-digit mobile number');
                    return false;
                }

                if (!email || !email.includes('@')) {
                    alert('Please enter a valid email address');
                    return false;
                }

                if (!password || password.length < 8) {
                    alert('Password must be at least 8 characters');
                    return false;
                }

                if (password !== confirmPassword) {
                    alert('Passwords do not match');
                    return false;
                }

                if (!pin || pin.length !== 6) {
                    alert('PIN must be exactly 6 digits');
                    return false;
                }

                if (pin !== confirmPin) {
                    alert('PINs do not match');
                    return false;
                }

                // Check simple sequential or repetitive PINs
                const isSequential = (str) => {
                    for (let i = 0; i < str.length - 1; i++) {
                        if (Math.abs(parseInt(str[i + 1]) - parseInt(str[i])) !== 1) return false;
                    }
                    return true;
                };
                if (isSequential(pin)) {
                    alert('PIN cannot be sequential');
                    return false;
                }
                if (/^(\d)\1{5}$/.test(pin)) {
                    alert('PIN cannot be repetitive');
                    return false;
                }

                if (captcha !== document.getElementById('captchaCode').textContent) {
                    alert('Invalid Verification Code');
                    return false;
                }

                if (!termsConsent || !privacyConsent || !dataConsent) {
                    alert('Please accept all mandatory consents');
                    return false;
                }

                return true;
            },

            saveStep1Data() {
                this.formData.step1 = {
                    mobile: document.getElementById('mobileNumber').value,
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                    pin: document.getElementById('pin').value,
                    securityHint: document.getElementById('securityHint').value,
                    timestamp: new Date().toISOString()
                };
                this.saveState();
            },

            // STEP 2 VALIDATION
            validateStep2() {
                const title = document.querySelector('input[name="title"]:checked');
                const firstName = document.getElementById('firstName').value;
                const lastName = document.getElementById('lastName').value;
                const dob = document.getElementById('dob').value;
                const gender = document.querySelector('input[name="gender"]:checked');

                if (!title) {
                    alert('Please select a title');
                    return false;
                }

                if (!firstName || firstName.trim().length < 2) {
                    alert('Please enter a valid first name');
                    return false;
                }

                if (!lastName || lastName.trim().length < 2) {
                    alert('Please enter a valid last name');
                    return false;
                }

                if (!dob) {
                    alert('Please enter your date of birth');
                    return false;
                }

                // Check age >= 18
                const dobDate = new Date(dob);
                const today = new Date();
                const age = today.getFullYear() - dobDate.getFullYear();
                const monthDiff = today.getMonth() - dobDate.getMonth();

                if (age < 18 || (age === 18 && monthDiff < 0)) {
                    alert('You must be at least 18 years old to register');
                    return false;
                }

                if (!gender) {
                    alert('Please select your gender');
                    return false;
                }

                return true;
            },

            saveStep2Data() {
                this.formData.step2 = {
                    title: document.querySelector('input[name="title"]:checked').value,
                    firstName: document.getElementById('firstName').value,
                    middleName: document.getElementById('middleName').value,
                    lastName: document.getElementById('lastName').value,
                    dob: document.getElementById('dob').value,
                    gender: document.querySelector('input[name="gender"]:checked').value,
                    nationality: 'Indian'
                };
                this.saveState();
            },

            // STEP 3 VALIDATION
            validateStep3() {
                const address1 = document.getElementById('address1').value;
                const address2 = document.getElementById('address2').value;
                const city = document.getElementById('city').value;
                const state = document.getElementById('state').value;
                const pincode = document.getElementById('pincode').value;

                if (!address1 || address1.trim().length < 5) {
                    alert('Please enter a valid address line 1');
                    return false;
                }

                if (!address2 || address2.trim().length < 5) {
                    alert('Please enter a valid address line 2');
                    return false;
                }

                if (!city || city.trim().length < 2) {
                    alert('Please enter a valid city');
                    return false;
                }

                if (!state) {
                    alert('Please select a state');
                    return false;
                }

                if (!pincode || !/^\d{6}$/.test(pincode)) {
                    alert('Please enter a valid 6-digit PIN code');
                    return false;
                }

                return true;
            },

            saveStep3Data() {
                this.formData.step3 = {
                    address1: document.getElementById('address1').value,
                    address2: document.getElementById('address2').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    pincode: document.getElementById('pincode').value,
                    sameAsPermanent: document.getElementById('sameAddress').checked
                };
                this.saveState();
            },

            // STEP 4 VALIDATION
            validateStep4() {
                const pan = document.getElementById('panNumber').value;
                const aadhaar = document.getElementById('aadhaarNumber').value;
                const aadhaarConsent = document.getElementById('aadhaarConsent').checked;

                // PAN validation: AAAAA1234A
                const panRegex = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
                if (!pan || !panRegex.test(pan.toUpperCase())) {
                    alert('Please enter a valid PAN number (Format: ABCDE1234F)');
                    return false;
                }

                // Aadhaar last 4 digits
                if (!aadhaar || aadhaar.trim().length < 4) {
                    alert('Please enter Aadhaar last 4 digits');
                    return false;
                }

                if (!aadhaarConsent) {
                    alert('Please provide consent for Aadhaar verification');
                    return false;
                }

                return true;
            },

            saveStep4Data() {
                this.formData.step4 = {
                    pan: document.getElementById('panNumber').value.toUpperCase(),
                    aadhaarLast4: document.getElementById('aadhaarNumber').value.slice(-4),
                    aadhaarConsent: true,
                    verificationTimestamp: new Date().toISOString()
                };
                this.saveState();
            },

            // STEP 5 VALIDATION
            validateStep5() {
                const consent = document.getElementById('finalConsent').checked;

                if (!consent) {
                    alert('Please accept the terms and conditions');
                    return false;
                }

                if (!this.hasSignature || !this.hasSignature()) {
                    alert('Please provide your digital signature');
                    return false;
                }

                return true;
            },

            saveStep5Data() {
                const canvas = document.getElementById('signatureCanvas');
                this.formData.step5 = {
                    consentAccepted: true,
                    consentTimestamp: new Date().toISOString(),
                    signatureData: canvas.toDataURL(),
                    deviceInfo: {
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        language: navigator.language
                    }
                };
                this.saveState();

            },

            saveState() {
                localStorage.setItem('signupFormState', JSON.stringify({
                    currentStep: this.currentStep,
                    formData: this.formData
                }));
            },

            restoreFields() {
                if (!this.formData) return;
                // Step 1
                if (this.formData.step1) {
                    document.getElementById('mobileNumber').value = this.formData.step1.mobile || '';
                    document.getElementById('email').value = this.formData.step1.email || '';
                    document.getElementById('password').value = this.formData.step1.password || '';
                    document.getElementById('pin').value = this.formData.step1.pin || '';
                    document.getElementById('securityHint').value = this.formData.step1.securityHint || '';
                }
                // Step 2
                if (this.formData.step2) {
                    if (this.formData.step2.title) {
                        const t = document.querySelector(`input[name="title"][value="${this.formData.step2.title}"]`);
                        if (t) t.checked = true;
                    }
                    document.getElementById('firstName').value = this.formData.step2.firstName || '';
                    document.getElementById('middleName').value = this.formData.step2.middleName || '';
                    document.getElementById('lastName').value = this.formData.step2.lastName || '';
                    document.getElementById('dob').value = this.formData.step2.dob || '';
                    if (this.formData.step2.gender) {
                        const g = document.querySelector(`input[name="gender"][value="${this.formData.step2.gender}"]`);
                        if (g) g.checked = true;
                    }
                }
                // Step 3
                if (this.formData.step3) {
                    document.getElementById('address1').value = this.formData.step3.address1 || '';
                    document.getElementById('address2').value = this.formData.step3.address2 || '';
                    document.getElementById('city').value = this.formData.step3.city || '';
                    document.getElementById('state').value = this.formData.step3.state || '';
                    document.getElementById('pincode').value = this.formData.step3.pincode || '';
                    document.getElementById('sameAddress').checked = !!this.formData.step3.sameAsPermanent;
                }
                // Step 4
                if (this.formData.step4 && !this.formData.step4.kycSkipped) {
                    document.getElementById('panNumber').value = this.formData.step4.pan || '';
                    document.getElementById('aadhaarNumber').value = this.formData.step4.aadhaarLast4 || '';
                    document.getElementById('aadhaarConsent').checked = !!this.formData.step4.aadhaarConsent;
                }
            },

            async submitApplication() {
                // Generate Customer ID (Visual only, real ID comes from DB or simple logic)
                const customerId = 'LA' + new Date().getFullYear() + Math.floor(Math.random() * 10000).toString().padStart(4, '0');
                document.getElementById('generatedCustomerId').textContent = customerId;

                // Prepare data for backend
                const payload = {
                    mobile_number: this.formData.step1.mobile,
                    email: this.formData.step1.email,
                    password: this.formData.step1.password
                };

                try {
                    const response = await fetch('http://localhost:8000/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || 'Registration failed');
                    }

                    const result = await response.json();
                    console.log('Backend Registration Success:', result);

                    // Go to confirmation
                    this.goToStep(6);

                } catch (error) {
                    console.error('Registration Error:', error);
                    alert('Error creating account: ' + error.message);
                    // Stay on step 5 or go back to step 1 if critical
                }
            }
        };

        // Initialize multi-step form on page load
        document.addEventListener('DOMContentLoaded', () => {
            multiStepForm.init();
        });
    </script>

    <script>
        /**
         * Secure Bank Account Registration System
         * RBI-Compliant Sign-up Implementation
         * 
         * Security Features:
         * - Client-side validation (server-side validation is mandatory)
         * - No plaintext storage of credentials
         * - Password strength validation
         * - PIN pattern validation (no sequential/repetitive)
         * - CAPTCHA verification
         * - DPDP Act compliance checkboxes
         * 
         * COMPLIANCE NOTES:
         * - All passwords/PINs must be hashed server-side using bcrypt/Argon2
         * - This is pre-KYC registration only
         * - Email used for communication, not authentication
         * - Passkey is optional and can be revoked
         */

        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            PASSWORD_MIN_LENGTH: 8,
            PASSWORD_MAX_LENGTH: 50,
            PIN_LENGTH: 6,
            MOBILE_LENGTH: 10,
            CAPTCHA_LENGTH: 6,
            SECURITY_HINT_MAX_LENGTH: 50,
        };

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        const state = {
            currentCaptcha: '',
            passkeySetup: 'skip', // 'skip' or 'setup'
            validations: {
                mobile: false,
                email: false,
                password: false,
                confirmPassword: false,
                pin: false,
                confirmPin: false,
                consents: false,
                captcha: false,
            }
        };

        // ============================================
        // DOM ELEMENTS
        // ============================================
        const elements = {
            form: document.getElementById('signupForm'),
            // signupButton removed as it is handled by multi-step script

            // Inputs
            mobileInput: document.getElementById('mobileNumber'),
            emailInput: document.getElementById('email'),
            passwordInput: document.getElementById('password'),
            confirmPasswordInput: document.getElementById('confirmPassword'),
            pinInput: document.getElementById('pin'),
            confirmPinInput: document.getElementById('confirmPin'),
            securityHintInput: document.getElementById('securityHint'),
            captchaInput: document.getElementById('captcha'),

            // Checkboxes
            termsConsent: document.getElementById('termsConsent'),
            privacyConsent: document.getElementById('privacyConsent'),
            dataConsent: document.getElementById('dataConsent'),
            rememberDevice: document.getElementById('rememberDevice'),
            enablePasskey: document.getElementById('enablePasskey'),

            // Error elements
            mobileError: document.getElementById('mobileError'),
            emailError: document.getElementById('emailError'),
            passwordError: document.getElementById('passwordError'),
            confirmPasswordError: document.getElementById('confirmPasswordError'),
            pinError: document.getElementById('pinError'),
            confirmPinError: document.getElementById('confirmPinError'),
            consentError: document.getElementById('consentError'),
            captchaError: document.getElementById('captchaError'),

            // Password strength
            passwordStrength: document.getElementById('passwordStrength'),
            passwordStrengthBar: document.getElementById('passwordStrengthBar'),
            passwordStrengthText: document.getElementById('passwordStrengthText'),

            // Buttons
            togglePassword: document.getElementById('togglePassword'),
            toggleConfirmPassword: document.getElementById('toggleConfirmPassword'),
            setupPasskey: document.getElementById('setupPasskey'),
            skipPasskey: document.getElementById('skipPasskey'),
            refreshCaptcha: document.getElementById('refreshCaptcha'),

            // CAPTCHA
            captchaDisplay: document.getElementById('captchaDisplay'),
            captchaCode: document.getElementById('captchaCode'),

            // Alert
            alertMessage: document.getElementById('alertMessage'),
            alertIcon: document.getElementById('alertIcon'),
            alertText: document.getElementById('alertText'),
        };

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        /**
         * Generate random alphanumeric CAPTCHA
         */
        function generateCaptcha() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let captcha = '';
            for (let i = 0; i < CONFIG.CAPTCHA_LENGTH; i++) {
                captcha += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return captcha;
        }

        /**
         * Display new CAPTCHA
         */
        function refreshCaptcha() {
            state.currentCaptcha = generateCaptcha();
            elements.captchaCode.textContent = state.currentCaptcha;
            elements.captchaInput.value = '';
            state.validations.captcha = false;
            updateSignupButtonState();
        }

        /**
         * Show alert message
         */
        function showAlert(message, type = 'error') {
            const icons = {
                error: '‚ö†Ô∏è',
                success: '‚úì',
                info: '‚ÑπÔ∏è'
            };

            elements.alertMessage.className = `alert alert-${type} show`;
            elements.alertIcon.textContent = icons[type];
            elements.alertText.textContent = message;

            // Auto-hide after 7 seconds
            setTimeout(() => {
                elements.alertMessage.classList.remove('show');
            }, 7000);
        }

        /**
         * Show field error
         */
        function showFieldError(errorElement, message) {
            errorElement.textContent = message;
            errorElement.classList.add('show');
        }

        /**
         * Clear field error
         */
        function clearFieldError(errorElement) {
            errorElement.textContent = '';
            errorElement.classList.remove('show');
        }

        // ============================================
        // VALIDATION FUNCTIONS
        // ============================================

        /**
         * Validate mobile number (Indian format)
         */
        function validateMobile(mobile) {
            const mobileRegex = /^[6-9]\d{9}$/;
            return mobileRegex.test(mobile);
        }

        /**
         * Check if mobile already exists (mock API call)
         * In production, this would be a real API endpoint
         */
        async function checkMobileExists(mobile) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 300));

            // Mock: return true if mobile is 9876543210
            return mobile === '9876543210';
        }

        /**
         * Validate email format
         */
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        /**
         * Validate password strength
         * Returns: { valid: boolean, strength: string, message: string }
         */
        function validatePassword(password) {
            if (password.length < CONFIG.PASSWORD_MIN_LENGTH) {
                return {
                    valid: false,
                    strength: 'weak',
                    message: `Password must be at least ${CONFIG.PASSWORD_MIN_LENGTH} characters`
                };
            }

            if (password.length > CONFIG.PASSWORD_MAX_LENGTH) {
                return {
                    valid: false,
                    strength: 'weak',
                    message: `Password must not exceed ${CONFIG.PASSWORD_MAX_LENGTH} characters`
                };
            }

            const hasLower = /[a-z]/.test(password);
            const hasUpper = /[A-Z]/.test(password);
            const hasNumber = /\d/.test(password);
            const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);

            const strength = [hasLower, hasUpper, hasNumber, hasSpecial].filter(Boolean).length;

            if (strength < 3) {
                return {
                    valid: false,
                    strength: 'weak',
                    message: 'Weak: Add uppercase, lowercase, number, and special character'
                };
            } else if (strength === 3) {
                return {
                    valid: true,
                    strength: 'medium',
                    message: 'Medium: Consider adding more character variety'
                };
            } else {
                return {
                    valid: true,
                    strength: 'strong',
                    message: 'Strong: Excellent password!'
                };
            }
        }

        /**
         * Validate PIN
         * Must be 6 digits, not sequential, not repetitive
         */
        function validatePin(pin) {
            if (!/^\d{6}$/.test(pin)) {
                return { valid: false, message: 'PIN must be exactly 6 digits' };
            }

            // Check for sequential (123456 or 654321)
            const isSequential = (str) => {
                for (let i = 0; i < str.length - 1; i++) {
                    const diff = parseInt(str[i + 1]) - parseInt(str[i]);
                    if (Math.abs(diff) !== 1) return false;
                }
                return true;
            };

            if (isSequential(pin)) {
                return { valid: false, message: 'PIN cannot be sequential (e.g., 123456)' };
            }

            // Check for repetitive (111111, 222222, etc.)
            if (/^(\d)\1{5}$/.test(pin)) {
                return { valid: false, message: 'PIN cannot be repetitive (e.g., 111111)' };
            }

            return { valid: true, message: '' };
        }

        /**
         * Validate security hint (text only, no numbers)
         */
        function validateSecurityHint(hint) {
            if (!hint) return true; // Optional field

            if (/\d/.test(hint)) {
                return { valid: false, message: 'Security hint cannot contain numbers' };
            }

            if (hint.length > CONFIG.SECURITY_HINT_MAX_LENGTH) {
                return { valid: false, message: `Max ${CONFIG.SECURITY_HINT_MAX_LENGTH} characters` };
            }

            return { valid: true, message: '' };
        }

        /**
         * Validate CAPTCHA
         */
        function validateCaptcha(input) {
            return input.toUpperCase() === state.currentCaptcha;
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================

        /**
         * Handle mobile number input
         */
        elements.mobileInput.addEventListener('input', async (e) => {
            const mobile = e.target.value.trim();

            // Remove non-numeric
            e.target.value = mobile.replace(/\D/g, '');

            if (mobile.length === 0) {
                clearFieldError(elements.mobileError);
                elements.mobileInput.classList.remove('success', 'error');
                state.validations.mobile = false;
                updateSignupButtonState();
                return;
            }

            if (validateMobile(mobile)) {
                // Check if mobile already exists
                const exists = await checkMobileExists(mobile);

                if (exists) {
                    showFieldError(elements.mobileError, 'This mobile number is already registered');
                    elements.mobileInput.classList.remove('success');
                    elements.mobileInput.classList.add('error');
                    state.validations.mobile = false;
                } else {
                    clearFieldError(elements.mobileError);
                    elements.mobileInput.classList.remove('error');
                    elements.mobileInput.classList.add('success');
                    state.validations.mobile = true;
                }
            } else {
                showFieldError(elements.mobileError, 'Invalid mobile number format');
                elements.mobileInput.classList.remove('success');
                elements.mobileInput.classList.add('error');
                state.validations.mobile = false;
            }

            updateSignupButtonState();
        });

        /**
         * Handle email input
         */
        elements.emailInput.addEventListener('input', (e) => {
            const email = e.target.value.trim();

            if (email.length === 0) {
                clearFieldError(elements.emailError);
                elements.emailInput.classList.remove('success', 'error');
                state.validations.email = false;
                updateSignupButtonState();
                return;
            }

            if (validateEmail(email)) {
                clearFieldError(elements.emailError);
                elements.emailInput.classList.remove('error');
                elements.emailInput.classList.add('success');
                state.validations.email = true;
            } else {
                showFieldError(elements.emailError, 'Please enter a valid email address');
                elements.emailInput.classList.remove('success');
                elements.emailInput.classList.add('error');
                state.validations.email = false;
            }

            updateSignupButtonState();
        });

        /**
         * Handle password input
         */
        elements.passwordInput.addEventListener('input', (e) => {
            const password = e.target.value;

            if (password.length === 0) {
                clearFieldError(elements.passwordError);
                elements.passwordInput.classList.remove('success', 'error');
                elements.passwordStrength.classList.remove('show');
                state.validations.password = false;
                updateSignupButtonState();
                return;
            }

            const validation = validatePassword(password);

            if (validation.valid) {
                clearFieldError(elements.passwordError);
                elements.passwordInput.classList.remove('error');
                elements.passwordInput.classList.add('success');
                state.validations.password = true;
            } else {
                showFieldError(elements.passwordError, validation.message);
                elements.passwordInput.classList.remove('success');
                elements.passwordInput.classList.add('error');
                state.validations.password = false;
            }

            // Update strength indicator
            elements.passwordStrength.classList.add('show');
            elements.passwordStrengthBar.className = `password-strength-bar ${validation.strength}`;
            elements.passwordStrengthText.textContent = validation.message;

            // Re-validate confirm password if filled
            if (elements.confirmPasswordInput.value) {
                elements.confirmPasswordInput.dispatchEvent(new Event('input'));
            }

            updateSignupButtonState();
        });

        /**
         * Handle confirm password input
         */
        elements.confirmPasswordInput.addEventListener('input', (e) => {
            const confirmPassword = e.target.value;
            const password = elements.passwordInput.value;

            if (confirmPassword.length === 0) {
                clearFieldError(elements.confirmPasswordError);
                elements.confirmPasswordInput.classList.remove('success', 'error');
                state.validations.confirmPassword = false;
                updateSignupButtonState();
                return;
            }

            if (confirmPassword === password && password.length > 0) {
                clearFieldError(elements.confirmPasswordError);
                elements.confirmPasswordInput.classList.remove('error');
                elements.confirmPasswordInput.classList.add('success');
                state.validations.confirmPassword = true;
            } else {
                showFieldError(elements.confirmPasswordError, 'Passwords do not match');
                elements.confirmPasswordInput.classList.remove('success');
                elements.confirmPasswordInput.classList.add('error');
                state.validations.confirmPassword = false;
            }

            updateSignupButtonState();
        });

        /**
         * Handle PIN input
         */
        elements.pinInput.addEventListener('input', (e) => {
            const pin = e.target.value.trim();

            // Remove non-numeric
            e.target.value = pin.replace(/\D/g, '');

            if (pin.length === 0) {
                clearFieldError(elements.pinError);
                elements.pinInput.classList.remove('success', 'error');
                state.validations.pin = false;
                updateSignupButtonState();
                return;
            }

            const validation = validatePin(pin);

            if (validation.valid) {
                clearFieldError(elements.pinError);
                elements.pinInput.classList.remove('error');
                elements.pinInput.classList.add('success');
                state.validations.pin = true;
            } else {
                showFieldError(elements.pinError, validation.message);
                elements.pinInput.classList.remove('success');
                elements.pinInput.classList.add('error');
                state.validations.pin = false;
            }

            // Re-validate confirm PIN if filled
            if (elements.confirmPinInput.value) {
                elements.confirmPinInput.dispatchEvent(new Event('input'));
            }

            updateSignupButtonState();
        });

        /**
         * Handle confirm PIN input
         */
        elements.confirmPinInput.addEventListener('input', (e) => {
            const confirmPin = e.target.value.trim();
            const pin = elements.pinInput.value;

            // Remove non-numeric
            e.target.value = confirmPin.replace(/\D/g, '');

            if (confirmPin.length === 0) {
                clearFieldError(elements.confirmPinError);
                elements.confirmPinInput.classList.remove('success', 'error');
                state.validations.confirmPin = false;
                updateSignupButtonState();
                return;
            }

            if (confirmPin === pin && pin.length === CONFIG.PIN_LENGTH) {
                clearFieldError(elements.confirmPinError);
                elements.confirmPinInput.classList.remove('error');
                elements.confirmPinInput.classList.add('success');
                state.validations.confirmPin = true;
            } else {
                showFieldError(elements.confirmPinError, 'PINs do not match');
                elements.confirmPinInput.classList.remove('success');
                elements.confirmPinInput.classList.add('error');
                state.validations.confirmPin = false;
            }

            updateSignupButtonState();
        });

        /**
         * Handle security hint input (optional field)
         */
        elements.securityHintInput.addEventListener('input', (e) => {
            const hint = e.target.value.trim();
            const validation = validateSecurityHint(hint);

            if (!validation.valid) {
                showFieldError(elements.securityHintError, validation.message);
            }
        });

        /**
         * Handle CAPTCHA input
         */
        elements.captchaInput.addEventListener('input', (e) => {
            const captcha = e.target.value.trim().toUpperCase();
            e.target.value = captcha;

            if (captcha.length === 0) {
                clearFieldError(elements.captchaError);
                elements.captchaInput.classList.remove('success', 'error');
                state.validations.captcha = false;
                updateSignupButtonState();
                return;
            }

            if (validateCaptcha(captcha)) {
                clearFieldError(elements.captchaError);
                elements.captchaInput.classList.remove('error');
                elements.captchaInput.classList.add('success');
                state.validations.captcha = true;
            } else {
                showFieldError(elements.captchaError, 'Invalid verification code');
                elements.captchaInput.classList.remove('success');
                elements.captchaInput.classList.add('error');
                state.validations.captcha = false;
            }

            updateSignupButtonState();
        });

        /**
         * Handle consent checkboxes
         */
        function validateConsents() {
            const allChecked = elements.termsConsent.checked &&
                elements.privacyConsent.checked &&
                elements.dataConsent.checked;

            if (allChecked) {
                clearFieldError(elements.consentError);
                state.validations.consents = true;
            } else {
                state.validations.consents = false;
            }

            updateSignupButtonState();
        }

        elements.termsConsent.addEventListener('change', validateConsents);
        elements.privacyConsent.addEventListener('change', validateConsents);
        elements.dataConsent.addEventListener('change', validateConsents);

        /**
         * Toggle password visibility
         */
        elements.togglePassword.addEventListener('click', () => {
            const type = elements.passwordInput.type === 'password' ? 'text' : 'password';
            elements.passwordInput.type = type;
            elements.togglePassword.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });

        elements.toggleConfirmPassword.addEventListener('click', () => {
            const type = elements.confirmPasswordInput.type === 'password' ? 'text' : 'password';
            elements.confirmPasswordInput.type = type;
            elements.toggleConfirmPassword.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });

        /**
         * Passkey buttons
         */
        elements.setupPasskey.addEventListener('click', () => {
            state.passkeySetup = 'setup';
            showAlert('Passkey setup will be initiated after account creation', 'info');
        });

        elements.skipPasskey.addEventListener('click', () => {
            state.passkeySetup = 'skip';
            showAlert('You can set up passkey later from account settings', 'info');
        });

        /**
         * Refresh CAPTCHA
         */
        elements.refreshCaptcha.addEventListener('click', refreshCaptcha);

        /**
         * Update signup button state - DISABLED (Handled by multi-step validation)
         */
        function updateSignupButtonState() {
            // Logic disabled to prevent conflicting state changes
        }

        /**
         * Handle form submission
         */
        // Form submit listener removed to prevent conflict with multi-step navigation

        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            // Generate initial CAPTCHA
            refreshCaptcha();

            // Focus first input
            elements.mobileInput.focus();

            console.log('Secure registration system initialized');
            console.log('Note: All credentials must be hashed server-side in production');
        }

        // Start the application
        init();
    </script>
</body>

</html>