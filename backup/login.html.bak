<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Secure Login - LoanAdvisor</title>

    <!-- Security Headers (should be enforced server-side) -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'">
    <meta name="referrer" content="no-referrer">

    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Banking Color Palette - Professional & Trustworthy */
            --primary-blue: #1e40af;
            --primary-dark: #1e3a8a;
            --secondary-gray: #64748b;
            --success-green: #10b981;
            --error-red: #ef4444;
            --warning-amber: #f59e0b;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --border-gray: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;

            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;

            /* Border Radius */
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            min-height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;

            /* Background handled by WebGL script */
            background: transparent;
            color: #e5e7eb;

            display: block;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* body::before removed to allow WebGL background */
        /*
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            background: 
                radial-gradient(circle at 20% 30%, rgba(30, 64, 175, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(30, 58, 138, 0.08) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
            animation: floatShapes 20s ease-in-out infinite;
        }
        */

        @keyframes floatShapes {

            0%,
            100% {
                opacity: 0.6;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.1);
            }
        }


        /* Full Width Layout Wrapper */
        .auth-layout {
            min-height: 100vh;
            width: 100%;
            display: flex;
            align-items: center;
            /* vertical center */
            justify-content: center;
            /* horizontal center */
            padding: 2rem;
            background: transparent;
            /* do NOT set background here */
        }


        /* Login Container */
        .login-container {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 1.25rem;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 8px 32px rgba(30, 64, 175, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);

            max-width: 550px;
            width: 100%;

            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .login-container:hover {
            box-shadow:
                0 25px 70px rgba(0, 0, 0, 0.6),
                0 10px 32px rgba(30, 64, 175, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Back to Home Link */
        .back-to-home {
            position: fixed;
            top: var(--spacing-lg);
            left: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            color: white;
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            padding: 0.5rem var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .back-to-home:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(-2px);
        }

        .back-to-home::before {
            content: '‚Üê';
            font-size: 1.125rem;
        }

        /* Header */
        .login-header {
            background: rgba(30, 64, 175, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            padding: 2.5rem 2rem 1.5rem 2rem;
            text-align: center;
            position: relative;
            border-top-left-radius: 1.25rem;
            border-top-right-radius: 1.25rem;
            box-shadow: 0 4px 16px rgba(30, 64, 175, 0.3);
        }


        .logo.admin-icon {
            width: 56px;
            height: 56px;
            margin: 0 auto 1rem;

            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), inset 0 1px 2px rgba(255, 255, 255, 0.3);

            display: flex;
            align-items: center;
            justify-content: center;
        }


        .login-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .login-header p {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        /* Form */
        .login-form {
            padding: 2rem 2rem 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Alert Messages */
        .alert {
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-lg);
            font-size: 0.875rem;
            display: none;
        }

        .alert.show {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .alert-icon {
            font-size: 1.125rem;
            flex-shrink: 0;
        }

        /* Form Groups */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: var(--spacing-sm);
        }

        .form-label .required {
            color: var(--error-red);
            margin-left: var(--spacing-xs);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem var(--spacing-md);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            font-size: 0.9375rem;
            color: #ffffff;
            font-weight: 500;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-control:focus {
            outline: none;
            border-color: rgba(147, 197, 253, 0.8);
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-control:disabled {
            background: var(--bg-light);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .form-control.error {
            border-color: var(--error-red);
        }

        .form-control.success {
            border-color: var(--success-green);
        }

        /* Input Group (for icons/buttons inside input) */
        .input-group {
            position: relative;
        }

        .input-group .form-control {
            padding-right: 3rem;
        }

        .input-icon {
            position: absolute;
            right: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            user-select: none;
            transition: color 0.2s ease;
        }

        .input-icon:hover {
            color: #ffffff;
        }

        /* Email Display (Masked) */
        .email-display {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: 0.75rem var(--spacing-md);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            font-size: 0.9375rem;
            color: #ffffff;
            font-weight: 500;
        }

        .email-display.hidden {
            display: none;
        }

        .email-icon {
            color: var(--secondary-gray);
            font-size: 1.125rem;
        }

        /* Form Text (Helper/Error) */
        .form-text {
            font-size: 0.8125rem;
            margin-top: var(--spacing-sm);
            display: none;
        }

        .form-text.show {
            display: block;
        }

        .form-text.error {
            color: var(--error-red);
        }

        .form-text.success {
            color: var(--success-green);
        }

        .form-text.info {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        /* Password Strength Indicator */
        .password-strength {
            height: 4px;
            background: var(--border-gray);
            border-radius: var(--radius-sm);
            margin-top: var(--spacing-sm);
            overflow: hidden;
            display: none;
        }

        .password-strength.show {
            display: block;
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            transition: width 0.3s ease, background-color 0.3s ease;
            border-radius: var(--radius-sm);
        }

        .password-strength-bar.weak {
            width: 33%;
            background: var(--error-red);
        }

        .password-strength-bar.medium {
            width: 66%;
            background: var(--warning-amber);
        }

        .password-strength-bar.strong {
            width: 100%;
            background: var(--success-green);
        }

        /* CAPTCHA Container */
        .captcha-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .captcha-display {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.75rem;
            font-weight: bold;
            letter-spacing: 0.5rem;
            color: #ffffff;
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .captcha-display::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: repeating-linear-gradient(90deg,
                    var(--border-gray) 0px,
                    var(--border-gray) 5px,
                    transparent 5px,
                    transparent 10px);
            transform: translateY(-50%) rotate(-3deg);
        }

        .captcha-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .captcha-input {
            flex: 1;
        }

        .btn-refresh {
            padding: 0.75rem var(--spacing-md);
            background: var(--bg-white);
            border: 1px solid var(--border-gray);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.125rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-refresh:hover {
            background: var(--bg-light);
            border-color: var(--secondary-gray);
        }

        /* Primary Button */
        .btn-primary {
            width: 100%;
            padding: 0.875rem var(--spacing-md);
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: var(--spacing-md);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:disabled {
            background: var(--secondary-gray);
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Footer */
        .login-footer {
            padding: 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
            margin-bottom: var(--spacing-md);
        }

        .footer-links a {
            color: #ffffff;
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 600;
            transition: color 0.2s ease;
        }

        .footer-links a:hover {
            color: #93c5fd;
            text-decoration: underline;
        }

        .footer-text {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        /* Security Badge */
        .security-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-md);
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .security-icon {
            color: var(--success-green);
        }

        /* Lockout Screen */
        .lockout-screen {
            display: none;
            padding: var(--spacing-xl);
            text-align: center;
        }

        .lockout-screen.show {
            display: block;
        }

        .lockout-icon {
            font-size: 4rem;
            color: var(--error-red);
            margin-bottom: var(--spacing-lg);
        }

        .lockout-screen h2 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
        }

        .lockout-screen p {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            margin-right: var(--spacing-sm);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 968px) {
            .auth-layout {
                justify-content: center;
                padding-left: 2rem;
            }
        }

        @media (max-width: 480px) {
            .auth-layout {
                padding: 1rem;
            }

            .login-container {
                border-radius: 0.75rem;
                max-width: 100%;
            }

            .login-header {
                padding: 1.25rem 1rem 1rem 1rem;
            }

            .login-form {
                padding: 1.25rem 1rem 1rem 1rem;
            }

            .captcha-display {
                font-size: 1.5rem;
                letter-spacing: 0.3rem;
            }

            .back-to-home {
                position: absolute;
                top: 0.75rem;
                left: 0.75rem;
            }
        }

        /* Accessibility Improvements */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus visible for keyboard navigation */
        *:focus-visible {
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }
    </style>
</head>

<body>
    <a href="/" class="back-to-home">Back to Home</a>
    <div class="auth-layout">
        <div class="login-container">
            <!-- Header -->
            <div class="login-header">
                <div class="logo admin-icon">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                        <path d="M12 12c2.76 0 5-2.24 5-5S14.76 2 12 2 7 4.24 7 7s2.24 5 5 5z" fill="white" />
                        <path d="M4 20c0-4 4-6 8-6s8 2 8 6" fill="white" />
                    </svg>
                </div>

                <h1>Secure Login</h1>
                <p>Access your loan account securely</p>
            </div>

            <!-- Login Form -->
            <form class="login-form" id="loginForm" novalidate>
                <!-- Alert Message -->
                <div class="alert" id="alertMessage" role="alert">
                    <span class="alert-icon" id="alertIcon"></span>
                    <span id="alertText"></span>
                </div>
            </form>

            <script>
                document.getElementById('loginForm').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const mobileNumber = document.getElementById('mobileNumber').value;
                    const password = document.getElementById('password').value;
                    const alertMessage = document.getElementById('alertMessage');
                    const alertText = document.getElementById('alertText');

                    // Reset alert
                    alertMessage.classList.remove('show', 'alert-error', 'alert-success');

                    try {
                        const response = await fetch('http://localhost:8000/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                mobile_number: mobileNumber,
                                password: password
                            })
                        });

                        const data = await response.json();

                        if (response.ok) {
                            // Success
                            alertMessage.classList.add('show', 'alert-success');
                            alertText.textContent = "Login Successful! Redirecting...";

                            setTimeout(() => {
                                // Redirect to dashboard (assuming index.html or dashboard.html)
                                window.location.href = '/index.html';
                            }, 1500);
                        } else {
                            // Error
                            throw new Error(data.detail || 'Login failed');
                        }

                    } catch (error) {
                        alertMessage.classList.add('show', 'alert-error');
                        alertText.textContent = error.message;
                    }
                });
            </script>

            <!-- Mobile Number / Customer ID -->
            <div class="form-group">
                <label for="mobileNumber" class="form-label">
                    Mobile Number / Customer ID<span class="required">*</span>
                </label>
                <input type="text" id="mobileNumber" class="form-control" placeholder="Enter 10-digit mobile number"
                    autocomplete="username" inputmode="numeric" maxlength="10" required aria-describedby="mobileError">
                <div class="form-text error" id="mobileError"></div>
            </div>

            <!-- Email Display (Auto-fetched, Masked) -->
            <div class="form-group">
                <label class="form-label">Registered Email</label>
                <div class="email-display hidden" id="emailDisplay">
                    <span class="email-icon">üìß</span>
                    <span id="maskedEmail">-</span>
                </div>
                <div class="form-text info show">Email will be displayed after mobile verification</div>
            </div>

            <!-- Password -->
            <div class="form-group">
                <label for="password" class="form-label">
                    Password<span class="required">*</span>
                </label>
                <div class="input-group">
                    <input type="password" id="password" class="form-control" placeholder="Enter your password"
                        autocomplete="current-password" required aria-describedby="passwordError passwordStrength">
                    <span class="input-icon" id="togglePassword" tabindex="0" role="button"
                        aria-label="Toggle password visibility">
                        üëÅÔ∏è
                    </span>
                </div>
                <div class="password-strength" id="passwordStrength" aria-live="polite">
                    <div class="password-strength-bar" id="passwordStrengthBar"></div>
                </div>
                <div class="form-text error" id="passwordError"></div>
            </div>

            <!-- 6-Digit PIN -->
            <div class="form-group">
                <label for="pin" class="form-label">
                    6-Digit PIN<span class="required">*</span>
                </label>
                <input type="password" id="pin" class="form-control" placeholder="Enter 6-digit PIN" autocomplete="off"
                    inputmode="numeric" maxlength="6" required aria-describedby="pinError">
                <div class="form-text error" id="pinError"></div>
            </div>

            <!-- CAPTCHA -->
            <div class="form-group">
                <label for="captcha" class="form-label">
                    Verification Code<span class="required">*</span>
                </label>
                <div class="captcha-container">
                    <div class="captcha-display" id="captchaDisplay" aria-label="Captcha image">
                        <span id="captchaCode">LOADING</span>
                    </div>
                    <div class="captcha-actions">
                        <input type="text" id="captcha" class="form-control captcha-input"
                            placeholder="Enter code above" autocomplete="off" maxlength="6" required
                            aria-describedby="captchaError">
                        <button type="button" class="btn-refresh" id="refreshCaptcha" aria-label="Refresh captcha">
                            üîÑ
                        </button>
                    </div>
                    <div class="form-text error" id="captchaError"></div>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn-primary" id="loginButton" disabled>
                Login Securely
            </button>

            <!-- Security Badge -->
            <div class="security-badge">
                <span class="security-icon">üîí</span>
                <span>256-bit SSL Encrypted Connection</span>
            </div>
            </form>

            <!-- Lockout Screen (Hidden by default) -->
            <div class="lockout-screen" id="lockoutScreen">
                <div class="lockout-icon">üîí</div>
                <h2>Account Temporarily Locked</h2>
                <p>Your account has been temporarily locked due to multiple failed login attempts. Please try again
                    after <strong><span id="lockoutTimer">15</span> minutes</strong> or contact customer support.</p>
                <div class="footer-links">
                    <a href="#support">Contact Support</a>
                    <a href="#reset">Reset Password</a>
                </div>
            </div>

            <!-- Footer -->
            <div class="login-footer">
                <div class="footer-links">
                    <a href="#forgot-password">Forgot Password?</a>
                    <a href="#forgot-pin">Forgot PIN?</a>
                    <a href="#support">Help & Support</a>
                </div>
                <p class="footer-text">
                    Protected by advanced security protocols. RBI compliant.
                </p>
                <p class="footer-text">
                    ¬© 2025 LoanAdvisor. All rights reserved.
                </p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // SMOKEY BACKGROUND WEBGL SHADER
        // ============================================
        (function () {
            // Create Canvas
            const canvas = document.createElement('canvas');
            canvas.id = 'smokey-background';
            canvas.style.position = 'fixed';
            canvas.style.top = '0';
            canvas.style.left = '0';
            canvas.style.width = '100vw';
            canvas.style.height = '100vh';
            canvas.style.zIndex = '-1';
            canvas.style.pointerEvents = 'none';
            document.body.prepend(canvas);

            // WebGL Context
            const gl = canvas.getContext("webgl");
            if (!gl) {
                console.error("WebGL not supported");
                return;
            }

            // Shaders
            const vertexSource = `
                attribute vec4 a_position;
                void main() {
                    gl_Position = a_position;
                }
            `;

            const fragmentSource = `
                precision mediump float;

                uniform vec2 iResolution;
                uniform float iTime;
                uniform vec2 iMouse;
                uniform vec3 u_color;

                void mainImage(out vec4 fragColor, in vec2 fragCoord){
                    vec2 uv = fragCoord / iResolution;
                    vec2 centeredUV = (2.0 * fragCoord - iResolution.xy) / min(iResolution.x, iResolution.y);

                    float time = iTime * 0.5;

                    vec2 mouse = iMouse / iResolution;
                    vec2 rippleCenter = 2.0 * mouse - 1.0;

                    vec2 distortion = centeredUV;
                    for (float i = 1.0; i < 8.0; i++) {
                        distortion.x += 0.5 / i * cos(i * 2.0 * distortion.y + time + rippleCenter.x * 3.1415);
                        distortion.y += 0.5 / i * cos(i * 2.0 * distortion.x + time + rippleCenter.y * 3.1415);
                    }

                    float wave = abs(sin(distortion.x + distortion.y + time));
                    float glow = smoothstep(0.9, 0.2, wave);

                    fragColor = vec4(u_color * glow, 1.0);
                }

                void main() {
                    mainImage(gl_FragColor, gl_FragCoord.xy);
                }
            `;

            function compileShader(type, source) {
                const shader = gl.createShader(type);
                gl.shaderSource(shader, source);
                gl.compileShader(shader);
                if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                    console.error("Shader compilation error:", gl.getShaderInfoLog(shader));
                    gl.deleteShader(shader);
                    return null;
                }
                return shader;
            }

            const vertexShader = compileShader(gl.VERTEX_SHADER, vertexSource);
            const fragmentShader = compileShader(gl.FRAGMENT_SHADER, fragmentSource);

            if (!vertexShader || !fragmentShader) return;

            const program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);

            if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                console.error("Program linking error:", gl.getProgramInfoLog(program));
                return;
            }

            gl.useProgram(program);

            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]), gl.STATIC_DRAW);

            const positionLocation = gl.getAttribLocation(program, "a_position");
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

            const iResolutionLocation = gl.getUniformLocation(program, "iResolution");
            const iTimeLocation = gl.getUniformLocation(program, "iTime");
            const iMouseLocation = gl.getUniformLocation(program, "iMouse");
            const uColorLocation = gl.getUniformLocation(program, "u_color");

            let startTime = Date.now();
            let mousePosition = { x: 0, y: 0 };
            let isHovering = false;

            function hexToRgb(hex) {
                const r = parseInt(hex.substring(1, 3), 16) / 255;
                const g = parseInt(hex.substring(3, 5), 16) / 255;
                const b = parseInt(hex.substring(5, 7), 16) / 255;
                return [r, g, b];
            }

            const [r, g, b] = hexToRgb("#1E40AF");
            gl.uniform3f(uColorLocation, r, g, b);

            function render() {
                const width = window.innerWidth;
                const height = window.innerHeight;

                if (canvas.width !== width || canvas.height !== height) {
                    canvas.width = width;
                    canvas.height = height;
                    gl.viewport(0, 0, width, height);
                }

                const currentTime = (Date.now() - startTime) / 1000;

                gl.uniform2f(iResolutionLocation, width, height);
                gl.uniform1f(iTimeLocation, currentTime);

                const targetX = isHovering ? mousePosition.x : width / 2;
                const targetY = isHovering ? height - mousePosition.y : height / 2;
                gl.uniform2f(iMouseLocation, targetX, targetY);

                gl.drawArrays(gl.TRIANGLES, 0, 6);
                requestAnimationFrame(render);
            }

            window.addEventListener('mousemove', (e) => {
                mousePosition = { x: e.clientX, y: e.clientY };
                isHovering = true;
            });

            window.addEventListener('mouseout', () => {
                isHovering = false;
            });

            render();
        })();
    </script>

    <script>
        /**
         * Secure Bank Login System
         * RBI-Compliant Authentication Implementation
         * 
         * Security Features:
         * - Client-side validation (server-side validation is mandatory)
         * - No plaintext storage of credentials
         * - Failed attempt tracking with account lockout
         * - CAPTCHA verification
         * - Neutral error messages to prevent information disclosure
         */

        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            MAX_LOGIN_ATTEMPTS: 3,
            LOCKOUT_DURATION_MINUTES: 15,
            PASSWORD_MIN_LENGTH: 8,
            PIN_LENGTH: 6,
            CAPTCHA_LENGTH: 6,
            MOBILE_NUMBER_LENGTH: 10,
        };

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        const state = {
            failedAttempts: 0,
            isLocked: false,
            lockoutEndTime: null,
            currentCaptcha: '',
            emailFetched: false,
            validations: {
                mobile: false,
                password: false,
                pin: false,
                captcha: false,
            }
        };

        // ============================================
        // DOM ELEMENTS
        // ============================================
        const elements = {
            // Form
            form: document.getElementById('loginForm'),
            loginButton: document.getElementById('loginButton'),

            // Inputs
            mobileInput: document.getElementById('mobileNumber'),
            passwordInput: document.getElementById('password'),
            pinInput: document.getElementById('pin'),
            captchaInput: document.getElementById('captcha'),

            // Displays
            emailDisplay: document.getElementById('emailDisplay'),
            maskedEmail: document.getElementById('maskedEmail'),
            captchaDisplay: document.getElementById('captchaDisplay'),
            captchaCode: document.getElementById('captchaCode'),

            // Error messages
            mobileError: document.getElementById('mobileError'),
            passwordError: document.getElementById('passwordError'),
            pinError: document.getElementById('pinError'),
            captchaError: document.getElementById('captchaError'),

            // Password strength
            passwordStrength: document.getElementById('passwordStrength'),
            passwordStrengthBar: document.getElementById('passwordStrengthBar'),

            // Buttons
            togglePassword: document.getElementById('togglePassword'),
            refreshCaptcha: document.getElementById('refreshCaptcha'),

            // Alert
            alertMessage: document.getElementById('alertMessage'),
            alertIcon: document.getElementById('alertIcon'),
            alertText: document.getElementById('alertText'),

            // Lockout
            lockoutScreen: document.getElementById('lockoutScreen'),
            lockoutTimer: document.getElementById('lockoutTimer'),
        };

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        /**
         * Generate random alphanumeric CAPTCHA
         */
        function generateCaptcha() {
            const chars = 'ABCDEFGHIJKLMNPQRSTUVWXYZ123456789'; // Removed similar looking chars
            let captcha = '';
            for (let i = 0; i < CONFIG.CAPTCHA_LENGTH; i++) {
                captcha += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return captcha;
        }

        /**
         * Display new CAPTCHA
         */
        function refreshCaptcha() {
            state.currentCaptcha = generateCaptcha();
            elements.captchaCode.textContent = state.currentCaptcha;
            elements.captchaInput.value = '';
            state.validations.captcha = false;
            updateLoginButtonState();
        }

        /**
         * Show alert message
         */
        function showAlert(message, type = 'error') {
            const icons = {
                error: '‚ö†Ô∏è',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è',
                success: '‚úì'
            };

            elements.alertMessage.className = `alert alert-${type} show`;
            elements.alertIcon.textContent = icons[type];
            elements.alertText.textContent = message;

            // Auto-hide after 5 seconds
            setTimeout(() => {
                elements.alertMessage.classList.remove('show');
            }, 5000);
        }

        /**
         * Show field error
         */
        function showFieldError(errorElement, message) {
            errorElement.textContent = message;
            errorElement.classList.add('show');
        }

        /**
         * Clear field error
         */
        function clearFieldError(errorElement) {
            errorElement.textContent = '';
            errorElement.classList.remove('show');
        }

        /**
         * Mask email address
         * Example: j***n@ex***e.com
         */
        function maskEmail(email) {
            const [local, domain] = email.split('@');
            const [domainName, domainExt] = domain.split('.');

            const maskedLocal = local.charAt(0) + '***' + local.charAt(local.length - 1);
            const maskedDomain = domainName.substring(0, 2) + '***' + domainExt.charAt(0);

            return `${maskedLocal}@${maskedDomain}.${domainExt}`;
        }

        /**
         * Simulate email fetch from backend
         * In production, this would be an API call
         */
        async function fetchRegisteredEmail(mobileNumber) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 500));

            // Mock email based on mobile number (for demo only)
            // In production, this comes from secure backend
            const mockEmails = {
                '9876543210': 'john.doe@example.com',
                '9999999999': 'test.user@email.com',
            };

            return mockEmails[mobileNumber] || 'user.test@domain.com';
        }

        // ============================================
        // VALIDATION FUNCTIONS
        // ============================================

        /**
         * Validate mobile number
         */
        function validateMobile(mobile) {
            // Must be 10 digits starting with 6-9
            const mobileRegex = /^[6-9]\d{9}$/;
            return mobileRegex.test(mobile);
        }

        /**
         * Validate password strength
         * Returns: { valid: boolean, strength: string, message: string }
         */
        function validatePassword(password) {
            if (password.length < CONFIG.PASSWORD_MIN_LENGTH) {
                return {
                    valid: false,
                    strength: 'weak',
                    message: `Password must be at least ${CONFIG.PASSWORD_MIN_LENGTH} characters`
                };
            }

            // Check for various character types
            const hasLower = /[a-z]/.test(password);
            const hasUpper = /[A-Z]/.test(password);
            const hasNumber = /\d/.test(password);
            const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);

            const strength = [hasLower, hasUpper, hasNumber, hasSpecial].filter(Boolean).length;

            if (strength < 2) {
                return {
                    valid: false,
                    strength: 'weak',
                    message: 'Password is too weak'
                };
            } else if (strength === 2) {
                return {
                    valid: true,
                    strength: 'medium',
                    message: 'Password strength: Medium'
                };
            } else {
                return {
                    valid: true,
                    strength: 'strong',
                    message: 'Password strength: Strong'
                };
            }
        }

        /**
         * Validate PIN
         */
        function validatePin(pin) {
            // Must be exactly 6 digits
            const pinRegex = /^\d{6}$/;
            return pinRegex.test(pin);
        }

        /**
         * Validate CAPTCHA
         */
        function validateCaptcha(input) {
            return input.toUpperCase() === state.currentCaptcha;
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================

        /**
         * Handle mobile number input
         */
        elements.mobileInput.addEventListener('input', async (e) => {
            const mobile = e.target.value.trim();

            // Remove non-numeric characters
            e.target.value = mobile.replace(/\D/g, '');

            if (mobile.length === 0) {
                clearFieldError(elements.mobileError);
                elements.mobileInput.classList.remove('success', 'error');
                state.validations.mobile = false;
                elements.emailDisplay.classList.add('hidden');
                updateLoginButtonState();
                return;
            }

            if (validateMobile(mobile)) {
                clearFieldError(elements.mobileError);
                elements.mobileInput.classList.remove('error');
                elements.mobileInput.classList.add('success');
                state.validations.mobile = true;

                // Fetch and display masked email
                if (!state.emailFetched || mobile !== elements.mobileInput.dataset.lastMobile) {
                    try {
                        const email = await fetchRegisteredEmail(mobile);
                        elements.maskedEmail.textContent = maskEmail(email);
                        elements.emailDisplay.classList.remove('hidden');
                        state.emailFetched = true;
                        elements.mobileInput.dataset.lastMobile = mobile;
                    } catch (error) {
                        showAlert('Unable to fetch email. Please try again.', 'warning');
                    }
                }
            } else {
                showFieldError(elements.mobileError, 'Invalid mobile number format');
                elements.mobileInput.classList.remove('success');
                elements.mobileInput.classList.add('error');
                state.validations.mobile = false;
                elements.emailDisplay.classList.add('hidden');
            }

            updateLoginButtonState();
        });

        /**
         * Handle password input
         */
        elements.passwordInput.addEventListener('input', (e) => {
            const password = e.target.value;

            if (password.length === 0) {
                clearFieldError(elements.passwordError);
                elements.passwordInput.classList.remove('success', 'error');
                elements.passwordStrength.classList.remove('show');
                state.validations.password = false;
                updateLoginButtonState();
                return;
            }

            const validation = validatePassword(password);

            if (validation.valid) {
                clearFieldError(elements.passwordError);
                elements.passwordInput.classList.remove('error');
                elements.passwordInput.classList.add('success');
                state.validations.password = true;
            } else {
                showFieldError(elements.passwordError, validation.message);
                elements.passwordInput.classList.remove('success');
                elements.passwordInput.classList.add('error');
                state.validations.password = false;
            }

            // Update strength bar
            elements.passwordStrength.classList.add('show');
            elements.passwordStrengthBar.className = `password-strength-bar ${validation.strength}`;

            updateLoginButtonState();
        });

        /**
         * Handle PIN input
         */
        elements.pinInput.addEventListener('input', (e) => {
            const pin = e.target.value.trim();

            // Remove non-numeric characters
            e.target.value = pin.replace(/\D/g, '');

            if (pin.length === 0) {
                clearFieldError(elements.pinError);
                elements.pinInput.classList.remove('success', 'error');
                state.validations.pin = false;
                updateLoginButtonState();
                return;
            }

            if (validatePin(pin)) {
                clearFieldError(elements.pinError);
                elements.pinInput.classList.remove('error');
                elements.pinInput.classList.add('success');
                state.validations.pin = true;
            } else {
                showFieldError(elements.pinError, 'PIN must be exactly 6 digits');
                elements.pinInput.classList.remove('success');
                elements.pinInput.classList.add('error');
                state.validations.pin = false;
            }

            updateLoginButtonState();
        });

        /**
         * Handle CAPTCHA input
         */
        elements.captchaInput.addEventListener('input', (e) => {
            const captcha = e.target.value.trim().toUpperCase();
            e.target.value = captcha;

            if (captcha.length === 0) {
                clearFieldError(elements.captchaError);
                elements.captchaInput.classList.remove('success', 'error');
                state.validations.captcha = false;
                updateLoginButtonState();
                return;
            }

            if (validateCaptcha(captcha)) {
                clearFieldError(elements.captchaError);
                elements.captchaInput.classList.remove('error');
                elements.captchaInput.classList.add('success');
                state.validations.captcha = true;
            } else {
                showFieldError(elements.captchaError, 'Invalid verification code');
                elements.captchaInput.classList.remove('success');
                elements.captchaInput.classList.add('error');
                state.validations.captcha = false;
            }

            updateLoginButtonState();
        });

        /**
         * Toggle password visibility
         */
        elements.togglePassword.addEventListener('click', () => {
            const type = elements.passwordInput.type === 'password' ? 'text' : 'password';
            elements.passwordInput.type = type;
            elements.togglePassword.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });

        // Keyboard accessibility for password toggle
        elements.togglePassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                elements.togglePassword.click();
            }
        });

        /**
         * Refresh CAPTCHA button
         */
        elements.refreshCaptcha.addEventListener('click', refreshCaptcha);

        /**
         * Update login button state
         */
        function updateLoginButtonState() {
            const allValid = Object.values(state.validations).every(v => v === true);
            elements.loginButton.disabled = !allValid || state.isLocked;
        }

        /**
         * Handle account lockout
         */
        function handleAccountLockout() {
            state.isLocked = true;
            state.lockoutEndTime = Date.now() + (CONFIG.LOCKOUT_DURATION_MINUTES * 60 * 1000);

            // Hide form, show lockout screen
            elements.form.style.display = 'none';
            elements.lockoutScreen.classList.add('show');

            // Start countdown timer
            const timerInterval = setInterval(() => {
                const remaining = Math.ceil((state.lockoutEndTime - Date.now()) / 1000 / 60);

                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    resetLockout();
                } else {
                    elements.lockoutTimer.textContent = remaining;
                }
            }, 1000);

            // Store lockout in sessionStorage (in production, use secure backend session)
            sessionStorage.setItem('lockoutEndTime', state.lockoutEndTime);
        }

        /**
         * Reset lockout state
         */
        function resetLockout() {
            state.isLocked = false;
            state.failedAttempts = 0;
            state.lockoutEndTime = null;
            elements.form.style.display = 'block';
            elements.lockoutScreen.classList.remove('show');
            sessionStorage.removeItem('lockoutEndTime');
            updateLoginButtonState();
        }

        /**
         * Handle form submission
         */
        elements.form.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (state.isLocked) {
                showAlert('Account is locked. Please wait or contact support.', 'error');
                return;
            }

            // Disable button during processing
            elements.loginButton.disabled = true;
            elements.loginButton.innerHTML = '<span class="spinner"></span>Authenticating...';

            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1500));

                /**
                 * SECURITY NOTE:
                 * In production, send credentials to backend over HTTPS
                 * Backend should:
                 * 1. Validate all inputs server-side
                 * 2. Hash password with bcrypt/Argon2 and compare
                 * 3. Verify PIN securely
                 * 4. Implement rate limiting
                 * 5. Log authentication attempts
                 * 6. Use secure session management
                 */

                // Mock authentication (for demo only)
                const credentials = {
                    mobile: elements.mobileInput.value,
                    // NEVER send plaintext passwords in production
                    // This is just for demo structure
                    passwordHash: btoa(elements.passwordInput.value), // Base64 encoding (NOT secure!)
                    pinHash: btoa(elements.pinInput.value), // Base64 encoding (NOT secure!)
                    captcha: elements.captchaInput.value,
                };

                // Simulate authentication failure (50% chance for demo)
                const isAuthenticated = Math.random() > 0.5;

                if (isAuthenticated) {
                    // SUCCESS
                    showAlert('Login successful! Redirecting...', 'success');

                    // Reset failed attempts
                    state.failedAttempts = 0;
                    sessionStorage.removeItem('failedAttempts');

                    // In production: Redirect to dashboard
                    setTimeout(() => {
                        // window.location.href = '/dashboard';
                        console.log('Would redirect to dashboard');
                    }, 2000);
                } else {
                    // FAILURE
                    state.failedAttempts++;
                    sessionStorage.setItem('failedAttempts', state.failedAttempts);

                    const remainingAttempts = CONFIG.MAX_LOGIN_ATTEMPTS - state.failedAttempts;

                    if (remainingAttempts > 0) {
                        // Neutral error message (don't reveal which field is wrong)
                        showAlert(
                            `Invalid credentials. ${remainingAttempts} attempt(s) remaining.`,
                            'error'
                        );

                        // Refresh CAPTCHA on failed attempt
                        refreshCaptcha();

                        // Clear sensitive fields
                        elements.passwordInput.value = '';
                        elements.pinInput.value = '';
                        elements.captchaInput.value = '';

                        state.validations.password = false;
                        state.validations.pin = false;
                        state.validations.captcha = false;
                    } else {
                        // Lock account
                        handleAccountLockout();
                        showAlert('Account locked due to multiple failed attempts.', 'error');
                    }
                }
            } catch (error) {
                showAlert('An error occurred. Please try again later.', 'error');
                console.error('Login error:', error);
            } finally {
                // Re-enable button
                elements.loginButton.innerHTML = 'Login Securely';
                updateLoginButtonState();
            }
        });

        // ============================================
        // INITIALIZATION
        // ============================================

        /**
         * Initialize the application
         */
        function init() {
            // Generate initial CAPTCHA
            refreshCaptcha();

            // Check for existing lockout
            const storedLockoutTime = sessionStorage.getItem('lockoutEndTime');
            if (storedLockoutTime) {
                const lockoutEnd = parseInt(storedLockoutTime, 10);
                if (Date.now() < lockoutEnd) {
                    state.lockoutEndTime = lockoutEnd;
                    handleAccountLockout();
                } else {
                    sessionStorage.removeItem('lockoutEndTime');
                }
            }

            // Restore failed attempts count
            const storedAttempts = sessionStorage.getItem('failedAttempts');
            if (storedAttempts) {
                state.failedAttempts = parseInt(storedAttempts, 10);
            }

            // Focus first input
            elements.mobileInput.focus();

            console.log('Secure login system initialized');
            console.log('Note: This is a demo. In production, all authentication must be handled server-side.');
        }

        // Start the application
        init();
    </script>
</body>

</html>